diff --git a/.gitignore b/.gitignore
index ae4d27e..d341012 100644
--- a/.gitignore
+++ b/.gitignore
@@ -9,3 +9,4 @@ obj
 build
 local.properties
 *~
+app/src/main/assets/ytdl/python*
diff --git a/app/build.gradle b/app/build.gradle
index 8ec2e54..fdfb735 100644
--- a/app/build.gradle
+++ b/app/build.gradle
@@ -9,7 +9,7 @@ android {
 
     defaultConfig {
         minSdkVersion 21
-        targetSdkVersion 31
+        targetSdkVersion 28
         versionCode 31
         versionName "2023-06-04-release"
         vectorDrawables.useSupportLibrary = true
@@ -30,6 +30,10 @@ android {
         viewBinding = true
     }
 
+    lintOptions {
+        disable 'ExpiredTargetSdkVersion'
+    }
+
     splits {
         abi {
             enable true
@@ -39,7 +43,7 @@ android {
                 if (new File(project.projectDir, "src/main/jniLibs/${abi}").exists())
                     include(abi)
             }
-            universalApk true // build an APK with all ABIs too
+            universalApk false // build an APK with all ABIs too
         }
     }
 
@@ -53,6 +57,12 @@ android {
     }
 }
 
+Calendar origin = Calendar.getInstance()
+origin.set(2021, Calendar.DECEMBER, 31, 23, 59)
+Date d1 = origin.getTime()
+Date d2 = new Date()
+long minutes = (d2.getTime() - d1.getTime()) / 1000 / 60
+def DateVersionCode = 2112312359 + minutes
 // Map versionCode so each ABI gets a different one
 // e.g. x86 with version 21 gets a versionCode of 3021
 import com.android.build.VariantOutput
@@ -61,7 +71,7 @@ android.applicationVariants.all { variant ->
         def base = project.ext.abiCodes.get(output.getFilter(VariantOutput.ABI))
         // universal APK keeps the original versionCode
         if (base != null)
-            output.versionCodeOverride = base * 1000 + variant.versionCode
+            output.versionCodeOverride = base * 1000 + variant.versionCode + DateVersionCode
     }
 }
 
diff --git a/app/src/main/AndroidManifest.xml b/app/src/main/AndroidManifest.xml
index aad153a..2d8d543 100644
--- a/app/src/main/AndroidManifest.xml
+++ b/app/src/main/AndroidManifest.xml
@@ -176,6 +176,119 @@
                 <category android:name="android.intent.category.DEFAULT" />
                 <data android:mimeType="text/plain" />
             </intent-filter>
+            <!-- various URL intent filters for popular youtube-dl extractors -->
+            <intent-filter>
+                <action android:name="android.intent.action.VIEW" />
+                <category android:name="android.intent.category.DEFAULT" />
+                <category android:name="android.intent.category.BROWSABLE" />
+                <data android:scheme="http" />
+                <data android:scheme="https" />
+                <data android:host="*.youtube.com" />
+                <data android:pathPattern="/watch.*" />
+            </intent-filter>
+            <intent-filter>
+                <action android:name="android.intent.action.VIEW" />
+                <category android:name="android.intent.category.DEFAULT" />
+                <category android:name="android.intent.category.BROWSABLE" />
+                <data android:scheme="http" />
+                <data android:scheme="https" />
+                <data android:host="youtube.com" />
+                <data android:pathPattern="/watch.*" />
+            </intent-filter>
+            <intent-filter>
+                <action android:name="android.intent.action.VIEW" />
+                <category android:name="android.intent.category.DEFAULT" />
+                <category android:name="android.intent.category.BROWSABLE" />
+                <data android:scheme="http" />
+                <data android:scheme="https" />
+                <data android:host="youtu.be" />
+                <data android:pathPattern=".*" />
+            </intent-filter>
+
+            <intent-filter> <!-- FIXME: all following patterns are suboptimal because they also match the homepages -->
+                <action android:name="android.intent.action.VIEW" />
+                <category android:name="android.intent.category.DEFAULT" />
+                <category android:name="android.intent.category.BROWSABLE" />
+                <data android:scheme="http" />
+                <data android:scheme="https" />
+                <data android:host="www.vimeo.com" />
+                <data android:pathPattern=".*" />
+            </intent-filter>
+            <intent-filter>
+                <action android:name="android.intent.action.VIEW" />
+                <category android:name="android.intent.category.DEFAULT" />
+                <category android:name="android.intent.category.BROWSABLE" />
+                <data android:scheme="http" />
+                <data android:scheme="https" />
+                <data android:host="vimeo.com" />
+                <data android:pathPattern=".*" />
+            </intent-filter>
+
+            <intent-filter>
+                <action android:name="android.intent.action.VIEW" />
+                <category android:name="android.intent.category.DEFAULT" />
+                <category android:name="android.intent.category.BROWSABLE" />
+                <data android:scheme="http" />
+                <data android:scheme="https" />
+                <data android:host="twitch.tv" />
+                <data android:pathPattern=".*" />
+            </intent-filter>
+            <intent-filter>
+                <action android:name="android.intent.action.VIEW" />
+                <category android:name="android.intent.category.DEFAULT" />
+                <category android:name="android.intent.category.BROWSABLE" />
+                <data android:scheme="http" />
+                <data android:scheme="https" />
+                <data android:host="m.twitch.tv" />
+                <data android:pathPattern=".*" />
+            </intent-filter>
+            <intent-filter>
+                <action android:name="android.intent.action.VIEW" />
+                <category android:name="android.intent.category.DEFAULT" />
+                <category android:name="android.intent.category.BROWSABLE" />
+                <data android:scheme="http" />
+                <data android:scheme="https" />
+                <data android:host="clips.twitch.tv" />
+                <data android:pathPattern=".*" />
+            </intent-filter>
+
+            <intent-filter>
+                <action android:name="android.intent.action.VIEW" />
+                <category android:name="android.intent.category.DEFAULT" />
+                <category android:name="android.intent.category.BROWSABLE" />
+                <data android:scheme="http" />
+                <data android:scheme="https" />
+                <data android:host="odysee.com" />
+                <data android:pathPattern="@.*" />
+            </intent-filter>
+
+            <intent-filter>
+                <action android:name="android.intent.action.VIEW" />
+                <category android:name="android.intent.category.DEFAULT" />
+                <category android:name="android.intent.category.BROWSABLE" />
+                <data android:scheme="http" />
+                <data android:scheme="https" />
+                <data android:host="bilibili.com" />
+                <data android:pathPattern=".*" />
+            </intent-filter>
+            <intent-filter>
+                <action android:name="android.intent.action.VIEW" />
+                <category android:name="android.intent.category.DEFAULT" />
+                <category android:name="android.intent.category.BROWSABLE" />
+                <data android:scheme="http" />
+                <data android:scheme="https" />
+                <data android:host="*.bilibili.com" />
+                <data android:pathPattern=".*" />
+            </intent-filter>
+            <intent-filter>
+                <action android:name="android.intent.action.VIEW" />
+                <category android:name="android.intent.category.DEFAULT" />
+                <category android:name="android.intent.category.BROWSABLE" />
+                <data android:scheme="http" />
+                <data android:scheme="https" />
+                <data android:host="b23.tv" />
+                <data android:pathPattern=".*" />
+            </intent-filter>
         </activity>
         <activity
             android:name=".MainActivity"
diff --git a/app/src/main/java/is/xyz/mpv/MPVActivity.kt b/app/src/main/java/is/xyz/mpv/MPVActivity.kt
index 05e17a6..3b1dfc7 100644
--- a/app/src/main/java/is/xyz/mpv/MPVActivity.kt
+++ b/app/src/main/java/is/xyz/mpv/MPVActivity.kt
@@ -291,6 +291,16 @@ class MPVActivity : AppCompatActivity(), MPVLib.EventObserver, TouchGesturesObse
             return
         }
 
+        // Remind user if they forgot to set up youtube-dl
+        if (!filepath.startsWith("/") && !filepath.substringAfterLast('/').contains('.')) {
+            if (!File("${filesDir.path}/youtube-dl").exists()) {
+                with (Toast.makeText(this, R.string.toast_need_ytdl, Toast.LENGTH_LONG)) {
+                    setGravity(toast.gravity, 0, 0)
+                    show()
+                }
+            }
+        }
+
         player.initialize(applicationContext.filesDir.path)
         player.addObserver(this)
         player.playFile(filepath)
diff --git a/app/src/main/java/is/xyz/mpv/MPVView.kt b/app/src/main/java/is/xyz/mpv/MPVView.kt
index 8ccf450..d4fe056 100644
--- a/app/src/main/java/is/xyz/mpv/MPVView.kt
+++ b/app/src/main/java/is/xyz/mpv/MPVView.kt
@@ -104,6 +104,14 @@ internal class MPVView(context: Context, attrs: AttributeSet) : SurfaceView(cont
             MPVLib.setOptionString("vd-lavc-skiploopfilter", "nonkey")
         }
 
+        MPVLib.setOptionString("ytdl", "yes")
+        sharedPreferences.getString("video_ytdl_format", "")?.also {
+            if (it.isNotEmpty())
+                MPVLib.setOptionString("ytdl-format", it)
+        }
+
+        // set basic options
+
         MPVLib.setOptionString("vo", "gpu")
         MPVLib.setOptionString("gpu-context", "android")
         MPVLib.setOptionString("opengl-es", "yes")
diff --git a/app/src/main/java/is/xyz/mpv/Utils.kt b/app/src/main/java/is/xyz/mpv/Utils.kt
index 609210e..363a612 100644
--- a/app/src/main/java/is/xyz/mpv/Utils.kt
+++ b/app/src/main/java/is/xyz/mpv/Utils.kt
@@ -27,8 +27,12 @@ import kotlin.math.abs
 object Utils {
     fun copyAssets(context: Context) {
         val assetManager = context.assets
-        val files = arrayOf("subfont.ttf", "cacert.pem")
+        val files = arrayOf(
+            "subfont.ttf", "cacert.pem",
+            "ytdl/python3", "ytdl/python39.zip", "ytdl/setup.py", "ytdl/wrapper"
+        )
         val configDir = context.filesDir.path
+        File("$configDir/ytdl").mkdir()
         for (filename in files) {
             var ins: InputStream? = null
             var out: OutputStream? = null
@@ -51,6 +55,13 @@ object Utils {
                 out?.close()
             }
         }
+
+        val execFiles = arrayOf("ytdl/python3", "ytdl/wrapper")
+        for (filename in execFiles) {
+            try {
+                File("$configDir/$filename").setExecutable(true)
+            } catch (e: IOException) {}
+        }
     }
 
     fun findRealPath(fd: Int): String? {
diff --git a/app/src/main/res/values/strings.xml b/app/src/main/res/values/strings.xml
index 2828c8c..a93eac8 100644
--- a/app/src/main/res/values/strings.xml
+++ b/app/src/main/res/values/strings.xml
@@ -49,6 +49,7 @@
     <string name="notice_show_media_files">Showing media files only</string>
     <string name="option_remember_choice">Remember choice on next startup</string>
     <string name="uri_invalid_protocol">Invalid protocol</string>
+    <string name="toast_need_ytdl">To play content from video platforms youtube-dl needs to be set up first.\nGo to Settings > Advanced and install youtube-dl there.</string>
 
     <!-- Action buttons -->
     <string name="switch_orientation">Switch Orientation</string>
@@ -169,11 +170,22 @@
     <string name="pref_edit_input_conf">Edit input.conf</string>
     <string name="pref_edit_input_conf_message">You can edit input.conf here, this is mainly useful for TV remotes and keyboards.\n\nImportant: mpv-android has some hardcoded keys which can\'t be redefined here, e.g. \'j\' to cycle subtitles.</string>
 
+    <string name="pref_ytdl_update">Install/Update youtube-dl</string>
+
+    <string name="pref_ytdl_format_title">Youtube-dl format</string>
+    <string name="pref_ytdl_format_message">The settings here influence the format/quality chosen by youtube-dl.</string>
+
     <!-- Strings used in Settings dialog preferences -->
     <string name="scaler_param1">Param 1:</string>
     <string name="scaler_param2">Param 2:</string>
     <string name="interpolation_switch">Enable Interpolation</string>
     <string name="interpolation_video_sync">Video sync:</string>
+    <string name="action_install">Install</string>
+    <string name="action_update">Update</string>
+    <string name="option_instructions">Select an option above.</string>
+    <string name="prefer_h264_switch">Prefer H.264</string>
+    <string name="max_quality">Max. Quality:</string>
+    <string name="quality_any">Any</string>
 
     <!-- File picker -->
     <string name="nnf_name">Name</string>
diff --git a/app/src/main/res/xml/pref_advanced.xml b/app/src/main/res/xml/pref_advanced.xml
index 3b90fee..8f4b75e 100644
--- a/app/src/main/res/xml/pref_advanced.xml
+++ b/app/src/main/res/xml/pref_advanced.xml
@@ -17,6 +17,11 @@
         android:positiveButtonText="@string/dialog_save"
         android:negativeButtonText="@string/dialog_cancel" />
 
+    <is.xyz.mpv.config.YtdlUpdateDialog
+        android:key=""
+        android:title="@string/pref_ytdl_update"
+        android:negativeButtonText="@null" />
+
     <is.xyz.mpv.config.VersionInfoDialog
         android:key=""
         android:title="@string/pref_version_info"
diff --git a/app/src/main/res/xml/pref_video.xml b/app/src/main/res/xml/pref_video.xml
index aa7ccc1..634117c 100644
--- a/app/src/main/res/xml/pref_video.xml
+++ b/app/src/main/res/xml/pref_video.xml
@@ -41,4 +41,9 @@
         android:summary="@string/pref_video_fastdecode_summary"
         android:title="@string/pref_video_fastdecode_title" />
 
+    <is.xyz.mpv.config.YtdlFormatPreference
+        android:key="video_ytdl_format"
+        android:dialogMessage="@string/pref_ytdl_format_message"
+        android:title="@string/pref_ytdl_format_title" />
+
 </PreferenceScreen>
diff --git a/buildscripts/buildall.sh b/buildscripts/buildall.sh
index 3e663d7..47aa3bb 100755
--- a/buildscripts/buildall.sh
+++ b/buildscripts/buildall.sh
@@ -163,6 +163,5 @@ setup_prefix
 build $target
 
 [ "$target" == "mpv-android" ] && \
-	ls -lh ../app/build/outputs/apk/{default,api29}/*/*.apk
 
 exit 0
diff --git a/buildscripts/include/download-deps.sh b/buildscripts/include/download-deps.sh
index 0525acd..50773b4 100755
--- a/buildscripts/include/download-deps.sh
+++ b/buildscripts/include/download-deps.sh
@@ -54,3 +54,9 @@ fi
 [ ! -d mpv ] && git clone https://github.com/mpv-player/mpv
 
 cd ..
+
+# youtube-dl
+$WGET https://kitsunemimi.pw/ytdl/dist.zip
+unzip dist.zip -d ../app/src/main/assets/ytdl
+rm -f ../app/src/main/assets/ytdl/youtube-dl # don't need it
+rm dist.zip
diff --git a/buildscripts/scripts/mpv-android.sh b/buildscripts/scripts/mpv-android.sh
index e8ae0c8..c58d1be 100755
--- a/buildscripts/scripts/mpv-android.sh
+++ b/buildscripts/scripts/mpv-android.sh
@@ -30,7 +30,6 @@ prefix_x86=$(nativeprefix "x86")
 
 PREFIX=$BUILD/prefix/armv7l PREFIX64=$prefix64 PREFIX_X64=$prefix_x64 PREFIX_X86=$prefix_x86 \
 ndk-build -C app/src/main -j$cores
-./gradlew assembleDebug assembleRelease
 
 if [ -n "${ANDROID_SIGNING_KEY:-}" ]; then
 	cd "${MPV_ANDROID}/app/build/outputs/apk"
diff --git a/gradle.properties b/gradle.properties
index aab9aa8..be15ce3 100644
--- a/gradle.properties
+++ b/gradle.properties
@@ -3,3 +3,4 @@ android.enableJetifier=true
 android.nonFinalResIds=false
 android.nonTransitiveRClass=true
 android.useAndroidX=true
+org.gradle.jvmargs=-Xmx2g -XX:MaxMetaspaceSize=512m -XX:+HeapDumpOnOutOfMemoryError -Dfile.encoding=UTF-8
